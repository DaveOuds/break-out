<html>
<canvas id="gameCanvas" width="800" height="600">
</canvas>
<script>
	//Canvas
	var canvas;
	var canvasContext;
	
	//Ball positioning
	var ballX = 395;
	var ballY = 295;
	var ballSpeedX = 0;
	var ballSpeedY = 10;
	
	//Paddle positioning
	const PADDLE_HEIGHT = 10;
	const PADDLE_WIDTH = 100;
	var paddle1X = 295;
	
	function calMousePos(evt){
		var rect = canvas.getBoundingClientRect();
		var root = document.documentElement;
		
		var mouseX = evt.clientX - rect.left - root.scrollLeft;
		var mouseY = evt.clientY - rect.top - root.scrollTop;
		
		return { x:mouseX, y:mouseY };
	}
	
	window.onload = function(){
		canvas = document.getElementById('gameCanvas');
		canvasContext = canvas.getContext('2d');	
		
		var fps = 30;
		setInterval(function(){
						drawEverything();
						moveEverything();
					}, 1000/fps);
					
		canvas.addEventListener('mousemove', 
								function(evt){
									var mousePos = calMousePos(evt);
									paddle1X = mousePos.x-50;
								})
	}
	
	function ballReset(){	
		ballY = canvas.height/2;
		ballSpeedX = 0;
	}
	
	function moveEverything(){
		ballX += ballSpeedX;
		ballY += ballSpeedY;
		
		//Bottom Reflect
		if (ballY > canvas.height) {
			if(( ballX > paddle1X) && (ballX < paddle1X+PADDLE_WIDTH)){
				ballSpeedY *= -1;
				
				var deltaX = ballX - (paddle1X+PADDLE_WIDTH/2);
				ballSpeedX = deltaX * 0.35;
			} else ballReset(); 
		}	
		
		// Left/Right reflect
		if (ballX < 0 || ballX > canvas.width) ballSpeedX *= -1;
		
		//Top Reflect
		if(ballY < 0) ballSpeedY*=-1;		
	}
	
	
	function drawEverything(){
	console.log(ballY)
		colorRect(0, 0, canvas.width, canvas.height, 'black');									//Background
		colorRect(paddle1X, 590, PADDLE_WIDTH, PADDLE_HEIGHT, 'white');							//Paddle 1
		colorCircle(ballX, ballY, 5,' white'); 													//Ball
	}
	
	function colorRect(x, y, width, height, color){
		canvasContext.fillStyle = color;
		canvasContext.fillRect(x, y, width, height);
	}
	
	function colorCircle(x, y, radius, color){
		canvasContext.fillStyle = color;
		canvasContext.beginPath();
		canvasContext.arc(x, y, radius, 0, Math.PI*2, true);
		canvasContext.fill();
	}
</script>
</html>
