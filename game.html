<html>
<canvas id="gameCanvas" width="800" height="600">
</canvas>
<script>
	//Canvas
	var canvas;
	var canvasContext;
	
	//Ball positioning
	var ballX = 395;
	var ballY = 295;
	var ballSpeedX = 0;
	var ballSpeedY = 10;
	
	//Paddle positioning
	const PADDLE_HEIGHT = 10;
	const PADDLE_WIDTH = 100;
	var paddle1X = 295;
	
	//Score / Lives 
	var lives =3;
	var showGameOver = false;

	
	//Bricks positioning -------------------------------------------------------------------------------------------------------------------
	const BRICK_HEIGHT = 20;
	const BRICK_WIDTH = 100;
	var brickArray = [[0,0],[100,0],[200,0],[300,0],[400,0],[500,0],[600,0],[700,0],[800,0]];
	
	//Event listeners -------------------------------------------------------------------------------------------------------------------
	function calMousePos(evt){
		var rect = canvas.getBoundingClientRect();
		var root = document.documentElement;
		
		var mouseX = evt.clientX - rect.left - root.scrollLeft;
		var mouseY = evt.clientY - rect.top - root.scrollTop;
		
		return { x:mouseX, y:mouseY };
	}
	
	function handleMouseClick(evt){
		if(showGameOver){
			lives = 3;
			showGameOver=false;
			console.log("reached")
		}
	}
	
	//Onload function -------------------------------------------------------------------------------------------------------------------
	window.onload = function(){
		canvas = document.getElementById('gameCanvas');
		canvasContext = canvas.getContext('2d');	
		
		var fps = 30;
		setInterval(function(){
						drawEverything();
						moveEverything();
					}, 1000/fps);
					
		canvas.addEventListener('mousemove', 
								function(evt){
									var mousePos = calMousePos(evt);
									paddle1X = mousePos.x-50;
								})
		canvas.addEventListener('mousedown', handleMouseClick)
	}
	
	function ballReset(){
		if(lives==0) showGameOver=true;
		
		ballY = canvas.height/2;
		ballSpeedX = 0;
	}
	
	function moveEverything(){
		if(showGameOver) return;
		ballX += ballSpeedX;
		ballY += ballSpeedY;
		
		if (ballY > canvas.height) {																									//Bottom Reflect
			if(( ballX > paddle1X) && (ballX < paddle1X+PADDLE_WIDTH)){
				ballSpeedY *= -1;
				
				var deltaX = ballX - (paddle1X+PADDLE_WIDTH/2);
				ballSpeedX = deltaX * 0.35;
			} else {
				lives--;
				ballReset(); 
			}
		}	
		
		if (ballX < 0 || ballX > canvas.width) ballSpeedX *= -1;																		// Left/Right reflect
		
		
		if(ballY < 0) ballSpeedY*=-1;																									//Top Reflect
		
		for(i = 0; i < brickArray.length; i++){
			if(ballY <= brickArray[i][1]+BRICK_HEIGHT && ((ballX > brickArray[i][0]) && (ballX < brickArray[i][0]+BRICK_WIDTH))) {
			ballSpeedY*=-1;
			brickArray.splice(i,1);
			}
		}
	}
	
	
	function drawEverything(){
	colorRect(0, 0, canvas.width, canvas.height, 'black');									//Background
	
		if(showGameOver) {
			canvasContext.fillStyle = 'white';
			canvasContext.fillText("Game Over", 350 ,100);
			canvasContext.fillText("Try again?", 350 ,120);
			canvasContext.fillText("Click to continue", 350 ,500);
			return;
		}
		
		colorRect(0, 0, canvas.width, canvas.height, 'black');									//Background
		colorRect(paddle1X, 590, PADDLE_WIDTH, PADDLE_HEIGHT, 'white');							//Paddle 1
		canvasContext.fillText(lives, 100, 100);
		colorCircle(ballX, ballY, 5,' white'); 													//Ball
		for(i=0; i < brickArray.length; i++){ 													//Bricks
			drawBrick(brickArray[i][0], brickArray[i][1]);
		}
	}
	
	function drawBrick (x, y){
		colorRect(x, y, BRICK_WIDTH, BRICK_HEIGHT, 'red');
		canvasContext.beginPath();
		canvasContext.lineWidth="3";
		canvasContext.strokeStyle="black";
		canvasContext.rect(x, y, BRICK_WIDTH, BRICK_HEIGHT)
		canvasContext.stroke();
	}
	
	function colorRect(x, y, width, height, color){
		canvasContext.fillStyle = color;
		canvasContext.fillRect(x, y, width, height);
	}
	
	function colorCircle(x, y, radius, color){
		canvasContext.fillStyle = color;
		canvasContext.beginPath();
		canvasContext.arc(x, y, radius, 0, Math.PI*2, true);
		canvasContext.fill();
	}	
</script>
</html>
